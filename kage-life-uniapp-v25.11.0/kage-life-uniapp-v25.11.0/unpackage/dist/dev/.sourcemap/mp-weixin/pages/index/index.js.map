{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../programs/HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <!-- 顶部日期 -->\n    <view class=\"header\">\n      <picker mode=\"date\" :value=\"currentDate\" @change=\"onDateChange\">\n        <text class=\"header-title\">{{ currentDate }}</text>\n      </picker>\n    </view>\n\n    <!-- 区块：标题 + 时间轴 -->\n    <view class=\"section\" v-for=\"section in sections\" :key=\"section.key\">\n      <view class=\"section-title\">{{ section.label }}</view>\n\n      <view class=\"timeline\" v-if=\"section.items.length\">\n        <view class=\"timeline-line\"></view>\n        <view class=\"timeline-list\">\n          <view class=\"timeline-item\" v-for=\"item in section.items\" :key=\"item.id\">\n            <view class=\"dot\"></view>\n            <view class=\"item-content\">\n              <text class=\"item-time\">{{ item.time }}</text>\n              <text class=\"item-text\">{{ item.title }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <view class=\"empty\" v-else>\n        <text>暂无记录</text>\n      </view>\n    </view>\n\n    <!-- 快速添加事项弹窗 -->\n    <view v-if=\"showAddPanel\" class=\"add-mask\" @tap=\"onCancelAdd\">\n      <view class=\"add-dialog\" @tap.stop>\n        <view class=\"add-title\">快速添加事项</view>\n\n        <!-- 输入行：先把 title 放进前端，再异步请求后端 -->\n        <view class=\"add-input-row\">\n          <input\n            v-model=\"newTitle\"\n            placeholder=\"输入事件标题，先显示在页面\"\n            placeholder-style=\"color:#9b9b9b;font-size:24rpx;\"\n            confirm-type=\"done\"\n            @confirm=\"onManualAdd\"\n          />\n          <button size=\"mini\" type=\"primary\" @tap=\"onManualAdd\">添加</button>\n        </view>\n        <view class=\"add-tip\">添加后会先插入列表，再调用后端保存</view>\n\n        <!-- 快捷选项 -->\n        <scroll-view scroll-y=\"true\" style=\"max-height: 400rpx;\">\n          <view\n            v-for=\"(item, index) in presetOptions\"\n            :key=\"index\"\n            class=\"add-option\"\n            @tap=\"onQuickAdd(index)\"\n          >\n            <text>{{ item }}</text>\n          </view>\n        </scroll-view>\n\n        <view class=\"add-actions\">\n          <button size=\"mini\" @tap=\"onCancelAdd\">关闭</button>\n        </view>\n      </view>\n    </view>\n\n    <!-- 右下角添加按钮 -->\n    <view class=\"fab\" @tap=\"onAdd\">\n      <text class=\"fab-plus\">+</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { computed, ref } from \"vue\"\nimport { onLoad } from \"@dcloudio/uni-app\"\n\nconst events = ref([])\n\nconst loading = ref(false)\nconst errorMsg = ref('')\nconst showAddPanel = ref(false)\nconst presetOptions = ref([])\nconst newTitle = ref('')\n\nconst now = new Date()\nconst y = now.getFullYear()\nconst m = String(now.getMonth() + 1).padStart(2, '0')\nconst d = String(now.getDate()).padStart(2, '0')\nconst today = `${y}-${m}-${d}`\nconst currentDate = ref(today)\n\nonLoad(() => {\n  fetchEvents()\n  loadEventTypes()\n})\n\nconst fetchEvents = (dateParam = currentDate.value) => {\n  currentDate.value = dateParam\n  loading.value = true\n  errorMsg.value = ''\n\n  uni.request({\n    url: 'https://k4ge.bar/api/events/',\n    method: 'GET',\n    data: { date: dateParam },\n    success: (res) => {\n      if (res.statusCode === 200 && res.data && Array.isArray(res.data.events)) {\n        events.value = res.data.events.map(e => ({\n          id: e.id,\n          time: e.start_time || '',\n          title: e.title || '',\n          raw: e,\n        }))\n      } else {\n        errorMsg.value = '接口返回异常'\n        console.log('接口异常', res)\n      }\n    },\n    fail: (err) => {\n      errorMsg.value = '网络请求失败'\n      console.error('请求失败', err)\n    },\n    complete: () => {\n      loading.value = false\n    }\n  })\n}\n\nconst loadEventTypes = () => {\n  uni.request({\n    url: 'https://k4ge.bar/api/event_types/',\n    method: 'GET',\n    success: (res) => {\n      if (!res.data || !res.data.event_types) {\n        uni.showToast({ title: '类型列表数据格式不对', icon: 'none' })\n        return\n      }\n      presetOptions.value = res.data.event_types.map((item) => item.description || item.type_name)\n    },\n    fail: (err) => {\n      console.error('加载事件类型失败', err)\n      uni.showToast({ title: '加载事件类型失败', icon: 'none' })\n    }\n  })\n}\n\nconst toMinutes = (time) => {\n  const [h, m] = (time || '00:00').split(':').map(Number)\n  return h * 60 + m\n}\n\nconst sections = computed(() => {\n  const morning = []\n  const noon = []\n  const afternoon = []\n  const night = []\n\n  const sorted = [...events.value].sort((a, b) => (a.time || '').localeCompare(b.time || ''))\n\n  sorted.forEach((e) => {\n    const minutes = toMinutes(e.time)\n    if (minutes < 11 * 60 + 30) {\n      morning.push(e)\n    } else if (minutes >= 11 * 60 + 30 && minutes <= 13 * 60 + 30) {\n      noon.push(e)\n    } else if (minutes < 17 * 60 + 30) {\n      afternoon.push(e)\n    } else {\n      night.push(e)\n    }\n  })\n\n  return [\n    { key: 'morning', label: '上午', items: morning },\n    { key: 'noon', label: '中午', items: noon },\n    { key: 'afternoon', label: '下午', items: afternoon },\n    { key: 'night', label: '晚上', items: night }\n  ]\n})\n\nconst onAdd = () => {\n  showAddPanel.value = true\n}\n\nconst buildNowTime = () => {\n  const now = new Date()\n  const hh = String(now.getHours()).padStart(2, '0')\n  const mm = String(now.getMinutes()).padStart(2, '0')\n  const time = `${hh}:${mm}`\n\n  const y = now.getFullYear()\n  const m = String(now.getMonth() + 1).padStart(2, '0')\n  const d = String(now.getDate()).padStart(2, '0')\n  const date = `${y}-${m}-${d}`\n\n  return { time, date }\n}\n\nconst addEventToFront = (title, timeParam, dateParam) => {\n  const { time, date } = timeParam && dateParam ? { time: timeParam, date: dateParam } : buildNowTime()\n  const tempId = `temp-${Date.now()}`\n\n  events.value.push({\n    id: tempId,\n    time,\n    title,\n    date,\n    raw: { pending: true }\n  })\n\n  return { tempId, time, date }\n}\n\nconst requestCreateEvent = (title, tempId, startTime) => {\n  uni.request({\n    url: 'https://k4ge.bar/api/events/create/',\n    method: 'GET',\n    data: { title, start_time: startTime },\n    success: (res) => {\n      if (res.statusCode === 201 && res.data && res.data.id) {\n        const target = events.value.find(e => e.id === tempId)\n        if (target) {\n          target.id = res.data.id\n          target.raw = res.data\n        }\n        uni.showToast({ title: '已保存', icon: 'success' })\n      } else {\n        handleCreateFail(tempId, '保存失败')\n      }\n    },\n    fail: () => {\n      handleCreateFail(tempId, '网络错误')\n    }\n  })\n}\n\nconst handleCreateFail = (tempId, message) => {\n  events.value = events.value.filter(e => e.id !== tempId)\n  uni.showToast({ title: message, icon: 'none' })\n}\n\nconst onQuickAdd = (index) => {\n  const title = presetOptions.value[index]\n  if (!title) {\n    uni.showToast({ title: '选项为空', icon: 'none' })\n    return\n  }\n\n  const { tempId, time } = addEventToFront(title)\n  showAddPanel.value = false\n  requestCreateEvent(title, tempId, time)\n}\n\nconst onManualAdd = () => {\n  const title = newTitle.value.trim()\n  if (!title) {\n    uni.showToast({ title: '请输入标题', icon: 'none' })\n    return\n  }\n\n  const { tempId, time } = addEventToFront(title)\n  newTitle.value = ''\n  showAddPanel.value = false\n  requestCreateEvent(title, tempId, time)\n}\n\nconst onCancelAdd = () => {\n  showAddPanel.value = false\n  newTitle.value = ''\n}\n\nconst onDateChange = (e) => {\n  const value = e?.detail?.value\n  if (!value) return\n  fetchEvents(value)\n}\n</script>\n\n<style scoped>\n.page {\n  padding: 24rpx;\n  padding-bottom: 120rpx;\n}\n\n.header {\n  margin-bottom: 24rpx;\n}\n\n.header-title {\n  font-size: 34rpx;\n  font-weight: 600;\n}\n\n.section {\n  margin-bottom: 32rpx;\n}\n\n.section-title {\n  font-size: 28rpx;\n  font-weight: 500;\n  margin-bottom: 12rpx;\n}\n\n.timeline {\n  display: flex;\n}\n\n.timeline-line {\n  width: 4rpx;\n  background-color: #e5e5e5;\n  margin-right: 24rpx;\n  border-radius: 2rpx;\n}\n\n.timeline-list {\n  flex: 1;\n}\n\n.timeline-item {\n  position: relative;\n  padding-bottom: 24rpx;\n}\n\n.dot {\n  position: absolute;\n  left: -34rpx;\n  top: 4rpx;\n  width: 14rpx;\n  height: 14rpx;\n  border-radius: 50%;\n  background-color: #409eff;\n}\n\n.item-content {\n  display: flex;\n  align-items: baseline;\n}\n\n.item-time {\n  font-size: 26rpx;\n  color: #999;\n  width: 140rpx;\n}\n\n.item-text {\n  font-size: 28rpx;\n}\n\n.empty {\n  padding-left: 24rpx;\n  color: #ccc;\n  font-size: 24rpx;\n}\n\n.fab {\n  position: fixed;\n  right: 40rpx;\n  bottom: 60rpx;\n  width: 96rpx;\n  height: 96rpx;\n  border-radius: 50%;\n  background-color: #409eff;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 8rpx 20rpx rgba(0, 0, 0, 0.2);\n}\n\n.fab-plus {\n  color: #fff;\n  font-size: 60rpx;\n  line-height: 1;\n}\n\n.add-mask {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.35);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999;\n  backdrop-filter: blur(4rpx);\n}\n\n.add-dialog {\n  width: 78%;\n  max-width: 620rpx;\n  background-color: #ffffff;\n  border-radius: 20rpx;\n  padding: 36rpx 32rpx 28rpx;\n  box-shadow: 0 18rpx 40rpx rgba(0, 0, 0, 0.2);\n}\n\n.add-title {\n  font-size: 30rpx;\n  font-weight: 600;\n  margin-bottom: 16rpx;\n}\n\n.add-input-row {\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n  flex-wrap: wrap;\n  padding: 16rpx 14rpx;\n  margin-bottom: 12rpx;\n  border-radius: 14rpx;\n  background-color: #f6f8fa;\n}\n\n.add-input-row input {\n  flex: 1;\n  border: 1rpx solid #e5e5e5;\n  border-radius: 12rpx;\n  padding: 18rpx 18rpx;\n  height: 76rpx;\n  line-height: 36rpx;\n  font-size: 26rpx;\n  box-sizing: border-box;\n  min-width: 0;\n}\n\n.add-input-row button {\n  flex-shrink: 0;\n  height: 76rpx;\n  line-height: 76rpx;\n  padding: 0 26rpx;\n}\n\n.add-tip {\n  font-size: 24rpx;\n  color: #999;\n  margin: 0 4rpx 18rpx;\n}\n\n.add-option {\n  padding: 18rpx 12rpx;\n  border-radius: 12rpx;\n  margin-bottom: 12rpx;\n  background-color: #f7f7f7;\n  font-size: 28rpx;\n}\n\n.add-option:active {\n  background-color: #e6f0ff;\n}\n\n.add-actions {\n  margin-top: 24rpx;\n  display: flex;\n  justify-content: flex-end;\n}\n</style>","import MiniProgramPage from 'E:/projects2/kage-life-uniapp-v25.11.0/kage-life-uniapp-v25.11.0/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","uni","m","computed","now","y","d"],"mappings":";;;;;AA8EA,UAAM,SAASA,cAAG,IAAC,EAAE;AAErB,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,eAAeA,cAAG,IAAC,KAAK;AAC9B,UAAM,gBAAgBA,cAAG,IAAC,EAAE;AAC5B,UAAM,WAAWA,cAAG,IAAC,EAAE;AAEvB,UAAM,MAAM,oBAAI,KAAM;AACtB,UAAM,IAAI,IAAI,YAAa;AAC3B,UAAM,IAAI,OAAO,IAAI,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG;AACpD,UAAM,IAAI,OAAO,IAAI,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAC/C,UAAM,QAAQ,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;AAC5B,UAAM,cAAcA,cAAG,IAAC,KAAK;AAE7BC,kBAAAA,OAAO,MAAM;AACX,kBAAa;AACb,qBAAgB;AAAA,IAClB,CAAC;AAED,UAAM,cAAc,CAAC,YAAY,YAAY,UAAU;AACrD,kBAAY,QAAQ;AACpB,cAAQ,QAAQ;AAChB,eAAS,QAAQ;AAEjBC,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM,EAAE,MAAM,UAAW;AAAA,QACzB,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,QAAQ,MAAM,QAAQ,IAAI,KAAK,MAAM,GAAG;AACxE,mBAAO,QAAQ,IAAI,KAAK,OAAO,IAAI,QAAM;AAAA,cACvC,IAAI,EAAE;AAAA,cACN,MAAM,EAAE,cAAc;AAAA,cACtB,OAAO,EAAE,SAAS;AAAA,cAClB,KAAK;AAAA,YACf,EAAU;AAAA,UACV,OAAa;AACL,qBAAS,QAAQ;AACjBA,0BAAAA,MAAY,MAAA,OAAA,gCAAA,QAAQ,GAAG;AAAA,UACxB;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACb,mBAAS,QAAQ;AACjBA,wBAAAA,qDAAc,QAAQ,GAAG;AAAA,QAC1B;AAAA,QACD,UAAU,MAAM;AACd,kBAAQ,QAAQ;AAAA,QACjB;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,iBAAiB,MAAM;AAC3BA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,SAAS,CAAC,QAAQ;AAChB,cAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,aAAa;AACtCA,0BAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AACnD;AAAA,UACD;AACD,wBAAc,QAAQ,IAAI,KAAK,YAAY,IAAI,CAAC,SAAS,KAAK,eAAe,KAAK,SAAS;AAAA,QAC5F;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAc,MAAA,SAAA,gCAAA,YAAY,GAAG;AAC7BA,wBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,QAClD;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,YAAY,CAAC,SAAS;AAC1B,YAAM,CAAC,GAAGC,EAAC,KAAK,QAAQ,SAAS,MAAM,GAAG,EAAE,IAAI,MAAM;AACtD,aAAO,IAAI,KAAKA;AAAA,IAClB;AAEA,UAAM,WAAWC,cAAQ,SAAC,MAAM;AAC9B,YAAM,UAAU,CAAE;AAClB,YAAM,OAAO,CAAE;AACf,YAAM,YAAY,CAAE;AACpB,YAAM,QAAQ,CAAE;AAEhB,YAAM,SAAS,CAAC,GAAG,OAAO,KAAK,EAAE,KAAK,CAAC,GAAG,OAAO,EAAE,QAAQ,IAAI,cAAc,EAAE,QAAQ,EAAE,CAAC;AAE1F,aAAO,QAAQ,CAAC,MAAM;AACpB,cAAM,UAAU,UAAU,EAAE,IAAI;AAChC,YAAI,UAAU,KAAK,KAAK,IAAI;AAC1B,kBAAQ,KAAK,CAAC;AAAA,QACpB,WAAe,WAAW,KAAK,KAAK,MAAM,WAAW,KAAK,KAAK,IAAI;AAC7D,eAAK,KAAK,CAAC;AAAA,QACZ,WAAU,UAAU,KAAK,KAAK,IAAI;AACjC,oBAAU,KAAK,CAAC;AAAA,QACtB,OAAW;AACL,gBAAM,KAAK,CAAC;AAAA,QACb;AAAA,MACL,CAAG;AAED,aAAO;AAAA,QACL,EAAE,KAAK,WAAW,OAAO,MAAM,OAAO,QAAS;AAAA,QAC/C,EAAE,KAAK,QAAQ,OAAO,MAAM,OAAO,KAAM;AAAA,QACzC,EAAE,KAAK,aAAa,OAAO,MAAM,OAAO,UAAW;AAAA,QACnD,EAAE,KAAK,SAAS,OAAO,MAAM,OAAO,MAAO;AAAA,MAC5C;AAAA,IACH,CAAC;AAED,UAAM,QAAQ,MAAM;AAClB,mBAAa,QAAQ;AAAA,IACvB;AAEA,UAAM,eAAe,MAAM;AACzB,YAAMC,OAAM,oBAAI,KAAM;AACtB,YAAM,KAAK,OAAOA,KAAI,SAAU,CAAA,EAAE,SAAS,GAAG,GAAG;AACjD,YAAM,KAAK,OAAOA,KAAI,WAAY,CAAA,EAAE,SAAS,GAAG,GAAG;AACnD,YAAM,OAAO,GAAG,EAAE,IAAI,EAAE;AAExB,YAAMC,KAAID,KAAI,YAAa;AAC3B,YAAMF,KAAI,OAAOE,KAAI,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG;AACpD,YAAME,KAAI,OAAOF,KAAI,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAC/C,YAAM,OAAO,GAAGC,EAAC,IAAIH,EAAC,IAAII,EAAC;AAE3B,aAAO,EAAE,MAAM,KAAM;AAAA,IACvB;AAEA,UAAM,kBAAkB,CAAC,OAAO,WAAW,cAAc;AACvD,YAAM,EAAE,MAAM,KAAM,IAAG,aAAa,YAAY,EAAE,MAAM,WAAW,MAAM,UAAS,IAAK,aAAc;AACrG,YAAM,SAAS,QAAQ,KAAK,IAAK,CAAA;AAEjC,aAAO,MAAM,KAAK;AAAA,QAChB,IAAI;AAAA,QACJ;AAAA,QACA;AAAA,QACA;AAAA,QACA,KAAK,EAAE,SAAS,KAAM;AAAA,MAC1B,CAAG;AAED,aAAO,EAAE,QAAQ,MAAM,KAAM;AAAA,IAC/B;AAEA,UAAM,qBAAqB,CAAC,OAAO,QAAQ,cAAc;AACvDL,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,YAAY,UAAW;AAAA,QACtC,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,QAAQ,IAAI,KAAK,IAAI;AACrD,kBAAM,SAAS,OAAO,MAAM,KAAK,OAAK,EAAE,OAAO,MAAM;AACrD,gBAAI,QAAQ;AACV,qBAAO,KAAK,IAAI,KAAK;AACrB,qBAAO,MAAM,IAAI;AAAA,YAClB;AACDA,0BAAG,MAAC,UAAU,EAAE,OAAO,OAAO,MAAM,WAAW;AAAA,UACvD,OAAa;AACL,6BAAiB,QAAQ,MAAM;AAAA,UAChC;AAAA,QACF;AAAA,QACD,MAAM,MAAM;AACV,2BAAiB,QAAQ,MAAM;AAAA,QAChC;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,mBAAmB,CAAC,QAAQ,YAAY;AAC5C,aAAO,QAAQ,OAAO,MAAM,OAAO,OAAK,EAAE,OAAO,MAAM;AACvDA,oBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAAA,IAChD;AAEA,UAAM,aAAa,CAAC,UAAU;AAC5B,YAAM,QAAQ,cAAc,MAAM,KAAK;AACvC,UAAI,CAAC,OAAO;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C;AAAA,MACD;AAED,YAAM,EAAE,QAAQ,SAAS,gBAAgB,KAAK;AAC9C,mBAAa,QAAQ;AACrB,yBAAmB,OAAO,QAAQ,IAAI;AAAA,IACxC;AAEA,UAAM,cAAc,MAAM;AACxB,YAAM,QAAQ,SAAS,MAAM,KAAM;AACnC,UAAI,CAAC,OAAO;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACD;AAED,YAAM,EAAE,QAAQ,SAAS,gBAAgB,KAAK;AAC9C,eAAS,QAAQ;AACjB,mBAAa,QAAQ;AACrB,yBAAmB,OAAO,QAAQ,IAAI;AAAA,IACxC;AAEA,UAAM,cAAc,MAAM;AACxB,mBAAa,QAAQ;AACrB,eAAS,QAAQ;AAAA,IACnB;AAEA,UAAM,eAAe,CAAC,MAAM;;AAC1B,YAAM,SAAQ,4BAAG,WAAH,mBAAW;AACzB,UAAI,CAAC;AAAO;AACZ,kBAAY,KAAK;AAAA,IACnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpRA,GAAG,WAAW,eAAe;"}